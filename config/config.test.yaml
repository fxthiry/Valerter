# Valerter Test Configuration
# Test contre logs.te-mgmt.io

victorialogs:
  url: "https://logs.te-mgmt.io"

defaults:
  throttle:
    count: 100
    window: 60s
  notify:
    template: "simple_alert"

templates:
  simple_alert:
    title: "üß™ Test Alert"
    body: |
      **Stream:** {{ _stream }}
      **Message:** {{ _msg | truncate(200) }}
      **Time:** {{ _time }}
    color: "#ffaa00"

  dns_alert:
    title: "üîç DNS Query"
    body: |
      **Client:** {{ client_ip }} ({{ client_name }})
      **Domain:** {{ domain }}
      **Type:** {{ query_type }}
      **Status:** {{ status }}
    color: "#00aa00"

rules:
  # Test avec du trafic DNS (tr√®s actif)
  - name: "test_dns_queries"
    enabled: true
    query: 'group:"dns-server" AND status:"NOERROR"'
    parser:
      json:
        fields: ["client_ip", "client_name", "domain", "query_type", "status"]
    throttle:
      count: 3
      window: 60s
    notify:
      template: "dns_alert"

  # R√®gle switch (peu de trafic - test du fix timeout)
  - name: "switch_platform_warning"
    enabled: true
    query: 'group:"sw" AND _msg:"%PLATFORM-4-ELEMENT_WARNING"'
    parser:
      json:
        fields: []
    throttle:
      count: 10
      window: 60s
