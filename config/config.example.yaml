# Valerter Configuration Example
# Copy to /etc/valerter/config.yaml and customize
#
# Quick Start Authentication Examples (uncomment ONE):
#
# 1. Basic Auth:
#    basic_auth:
#      username: "${VL_USER}"
#      password: "${VL_PASS}"
#
# 2. Bearer Token:
#    headers:
#      Authorization: "Bearer ${VL_TOKEN}"
#
# 3. Self-signed certificate:
#    tls:
#      verify: false

# VictoriaLogs connection settings
victorialogs:
  url: "http://victorialogs:9428"

  # ===== OPTIONAL: Authentication Options =====

  # Basic Auth (optional) - generates Authorization header automatically
  # Recommended: use environment variables for credentials
  # basic_auth:
  #   username: "${VL_USER}"
  #   password: "${VL_PASS}"

  # Custom headers (optional) - for tokens, API keys, etc.
  # Values should use environment variables for security
  # headers:
  #   Authorization: "Bearer ${VL_TOKEN}"
  #   X-API-Key: "${VL_API_KEY}"

  # TLS configuration (optional)
  # tls:
  #   verify: true    # Set to false for self-signed certificates (like curl -k)

# Metrics exposition settings
metrics:
  enabled: true       # Enable Prometheus metrics endpoint
  port: 9090          # Port for /metrics endpoint

# Default values applied to rules when not specified
defaults:
  throttle:
    count: 5          # Max alerts per window
    window: 60s       # Time window for throttling
  notify:
    template: "default_alert"

# Reusable message templates
templates:
  default_alert:
    title: "{{ title | default('Alert') }}"
    body: "{{ body }}"
    color: "#ff0000"

  custom_template:
    title: "{{ severity }}: {{ title }}"
    body: |
      **Host:** {{ host }}
      **Message:** {{ message }}
      **Time:** {{ timestamp }}
    color: "{{ '#ff0000' if severity == 'critical' else '#ffaa00' }}"
    icon: "warning"

# Alert rules
rules:
  - name: "high_cpu_alert"
    enabled: true
    query: '_stream:{host="server1"} | json | cpu > 90'
    parser:
      json:
        fields: ["host", "cpu", "timestamp"]
    throttle:
      key: "{{ host }}"      # Group throttling by host
      count: 3               # Max 3 alerts
      window: 5m             # Per 5 minutes
    notify:
      template: "default_alert"
      channel: "alerts"

  - name: "error_log_alert"
    enabled: true
    query: '_stream:{app="myapp"} level:error'
    parser:
      regex: '(?P<timestamp>\S+) (?P<level>\S+) (?P<message>.*)'
    # Uses defaults for throttle and notify

  - name: "disabled_example"
    enabled: false
    query: '_stream:{app="test"}'
    parser:
      json:
        fields: ["message"]

# Environment variables:
# - MATTERMOST_WEBHOOK: Webhook URL for notifications (required in production)
# - VL_USER: VictoriaLogs Basic Auth username (optional)
# - VL_PASS: VictoriaLogs Basic Auth password (optional)
# - VL_TOKEN: VictoriaLogs Bearer token (optional, use in headers section)
# - VL_API_KEY: VictoriaLogs API key (optional, use in headers section)
# - RUST_LOG: Log level (default: info)
# - LOG_FORMAT: Log output format - "text" (default) or "json"
#               Use "json" for log aggregation systems (Loki, ELK, etc.)
#               Use "text" for journalctl and human reading
